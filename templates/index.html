
<html><head><style>
#myContainer {
  width: 400px;
  height: 400px;
  position: relative;
  background: yellow;
}
#myAnimation {
  width: 50px;
  height: 50px;
  position: absolute;
  background-color: red;
}
</style>
<style type="text/css">#tryitLeaderboard ~ #container { top: 48px!important; }
#tryitLeaderboard ~ .trytopnav { top: 0!important; }</style></head><body>

<p>
<button onclick="myMove()">Click Me</button> 
</p>

<div id="myContainer">
<div id="myAnimation"></div>
</div>

<form action="index" method="post">
      <label>Name:<input type="text" id="name" value="" /></label>
      <button type="button" id="btn-post" onclick="do_ajax();">Click</button>
      <div id="result"></div>
</form>
    
<script>

var keys = [];
var mouse_x = 0;
var mouse_y = 0;

window.addEventListener("keydown",
    function(e){
        keys[e.keyCode] = e.keyCode;
        var keysArray = getNumberArray(keys);
    }, false);

window.addEventListener('keyup',
    function(e){
        keys[e.keyCode] = false;
    },false);

function getNumberArray(arr){
    var newArr = new Array();
    for(var i = 0; i < arr.length; i++){
        if(typeof arr[i] == "number"){
            newArr[newArr.length] = arr[i];
        }
    }
    return newArr;
}

window.addEventListener('mousemove', 
function(e){
    var m_posx = 0, m_posy = 0, e_posx = 0, e_posy = 0,
           obj = document.getElementById("myContainer");
    //get mouse position on document crossbrowser
    if (!e){e = window.event;}
    if (e.pageX || e.pageY){
        m_posx = e.pageX;
        m_posy = e.pageY;
    } else if (e.clientX || e.clientY){
        m_posx = e.clientX + document.body.scrollLeft
                 + document.documentElement.scrollLeft;
        m_posy = e.clientY + document.body.scrollTop
                 + document.documentElement.scrollTop;
    }
    //get parent element position in document
    if (obj.offsetParent){
        do { 
            e_posx += obj.offsetLeft;
            e_posy += obj.offsetTop;
        } while (obj = obj.offsetParent);
    }
    // mouse position minus elm position is mouseposition relative to element:
    mouse_x = (m_posx-e_posx); 
    mouse_y = (m_posx-e_posx);
}
, false);

do_redraw()

function do_redraw() {
    var req = new XMLHttpRequest();
    
    var data = {};
    
    req.onreadystatechange = function()
    {
        if(this.readyState == 4 && this.status == 200) {
        
            instruction_data = JSON.parse(JSON.parse(this.responseText))
            result.innerHTML = this.responseText;
            do_update(instruction_data)
            
        } else {
            result.innerHTML = "error...";
        }
    }

    req.open('POST', '/redraw', true);
    req.setRequestHeader("Content-Type", "application/json");
    req.send(JSON.stringify(data));
}
      
function do_ajax() {
    var req = new XMLHttpRequest();
    
    var data = {};
    data["keys_pressed"]=(getNumberArray(keys));
    data["mouse_x"]=mouse_x;
    data["mouse_y"]=mouse_y;
    
    req.onreadystatechange = function()
    {
        if(this.readyState == 4 && this.status == 200) {
        
            instruction_data = JSON.parse(JSON.parse(this.responseText))
            
            result.innerHTML = this.responseText;
            
            do_update(instruction_data)
            
        } else {
            result.innerHTML = "error...";
        }
    }
    
    req.open('POST', '/update', true);
    req.setRequestHeader("Content-Type", "application/json");
    req.send(JSON.stringify(data));
}
      
function do_update(instruction_data) {
     
    //result.innerHTML = instruction_data[0].params.id 
    for(var instr_i = 0; instr_i < instruction_data.length; instr_i++){
        if(instruction_data[instr_i].instruction == "new_obj")
        {
            var element = document.createElement("DIV"); 
            document.getElementById("myContainer").appendChild(element);
            element.setAttribute("id", instruction_data[instr_i].params.id);
            element.style.width = instruction_data[instr_i].params.width + 'px'; 
            element.style.height = instruction_data[instr_i].params.height + 'px'; 
            element.style.position = "absolute"; 
            element.style.top = instruction_data[instr_i].params.top + 'px'; 
            element.style.left = instruction_data[instr_i].params.left + 'px'; 
            element.style.backgroundColor = instruction_data[instr_i].params.backgroundColor;
            element.style.backgroundImage = instruction_data[instr_i].params.backgroundImage; 
        }
        if(instruction_data[instr_i].instruction  == "del_obj")
        {
            var element = document.getElementById( instruction_data[instr_i].params.id );
            element.parentNode.removeChild(element);
        }
        if(instruction_data[instr_i].instruction == "mod_obj")
        {
            var element = document.getElementById( instruction_data[instr_i].params.id );
            element.style.width = instruction_data[instr_i].params.width + 'px'; 
            element.style.height = instruction_data[instr_i].params.height + 'px'; 
            element.style.position = "absolute"; 
            element.style.top = instruction_data[instr_i].params.top + 'px'; 
            element.style.left = instruction_data[instr_i].params.left + 'px'; 
            element.style.backgroundColor = instruction_data[instr_i].params.backgroundColor;
            element.style.backgroundImage = instruction_data[instr_i].params.backgroundImage; 
        }
    }
    return "OK"
}
      
function myMove() {
  var id = setInterval(refresh, 100);
  function refresh() {
    if (pos == 350) {
      clearInterval(id);
    } else {
      do_ajax()
      pos++; 
      elem.style.top = pos + 'px'; 
      elem.style.left = pos + 'px'; 
    }
  }
}
</script>

</body></html>